---
title: '猕猴桃基因组组装'
date: 2025-08-08
permalink: /posts/2025/08/kiwifruit-genome-assembly/
tags:
  - 基因组
  - 猕猴桃
  - 生物信息学
---

这是我的第一篇博客文章，介绍猕猴桃的基因组组装过程。

# 介绍

基因组组装是...

# 组装流程
## 1. 数据准备

### 1.1 准备PacBio_HiFi_CSS、HIC测序数据和二代基因组测序数据
1. 任务名称为：  
    example
2. 三代基因组测序数据：  
    ~/data/example/PacBio_HiFi_CSS
3. HIC测序数据：  
    ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz
    ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz
4. 二代基因组测序数据：  
    ~/data/example/Illumina_WGS

### 1.2合并hifi测序数据
```bash
cat ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    > ~/data/example/PacBio_HiFi_CSS/example.ccs.fastq.gz
```
在~/data/example/PacBio_HiFi_CSS路径下得到合并后的文件：example.ccs.fastq.gz，作为hifiasm的输入文件
## 2. 估计基因组的基本特征
### 用jellyfish和genomescope预测基因组大小

## 3.运行hifiasm进行组装:
### 3.1运行hifiasm加入hic数据分型组装：
```bash
# 新建hifiasm输出目录
mkdir -p ~/work/example/hifiasm_output
# 运行hifiasm
hifiasm \
    -o ~/work/example/hifiasm_outpou/example \
    -t 20 \
    --h1 ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz \
    --h2 ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/example.ccs.fastq.gz
```
-o 输出文件路径/输出文件前缀，默认输出路径为当前路径，默认文件前缀为 [hifiasm.asm]  
-t 使用线程数，默认 [1]  
--h1 Hi-C R1文件列表，例如 [r1_1.fq,r1_2.fq,...]  
--h2 Hi-C R2文件列表，例如 [r2_1.fq,r2_2.fq,...]  
更多详情请参考官方文档：<https://hifiasm.readthedocs.io/en/latest/>

主要输出文件有：  
example.p_ctg.gfa：主要 contig 的组装图。该图包含长片段相位区块的完整组装。
example.hic.hap1.p_ctg.gfa：完全相位的单倍型1 contig 图，其中每个 contig 都是完全相位的。  
example.hic.hap2.p_ctg.gfa：完全相位的单倍型2 contig 图，其中每个 contig 都是完全相位的。  
### 3.2提取组装结果，保存为fasta格式
```
# 新建hifiasm输出文件保存为fasta格式路径
mkdir -p ~/work/example/hifiasm_output/fasta
# 使用awk进行提取
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.hap1.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.hap1.p_ctg.fa
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.hap2.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.hap2.p_ctg.fa
```
得到的三个文件路径为：  
example.hic.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa  
example.hic.hap1.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.hap1.p_ctg.fa  
example.hic.hap2.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.hap2.p_ctg.fa  
## 4. 组装质量检测
### 4.1 BUSCO评估基因组完整性
#### 4.1.1 BUSCO初始化
```
# 新建BUSCO数据库路径
mkdir -p ~/data/example/busco
# 进入BUSCO数据库路径
cd p ~/data/example/busco
#下载embryophyta_odb12数据库到当前路径
busco --download lineage_dataset embryophyta_odb12
```
#### 4.1.2 运行BUSCO评估基因组完整性
```
# 新建busco工作路径
mkdir -p ~/work/example/hifiasm_output/fasta/busco
# 进入busco工作路径
cd ~/work/example/hifiasm_output/fasta/busco
# 使用 BUSCO 评估基因组完整性
busco -c 16 \
    -i ~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa \
    -l ~/data/example/busco/busco_downloads/lineages/embryophyta_odb12 \
    -m genome \
    -o example \
    --out_path ~/work/example/hifiasm_output/fasta/busco
```
-c 使用的线程数量  
-i 输入文件，FASTA格式  
-l 要使用的数据库的名称  
-m 运行 BUSCO 的模式  
-o 分析任务的名称。输出文件夹和文件会以此命名。  
--out_path指定输出目录（不含结果文件夹名），默认是当前工作目录  

查看结果：
```
more ~/work/example/hifiasm_output/fasta/busco/example/short_summary.specific.embryophyta_odb12.taishan01.txt
``` 
C:98.1%[S:61.8%,D:36.3%],F:1.5%,M:0.3%,n:2026,E:2.6%

| 指标 | 英文全称 | 中文含义 | 说明 |
|:----:|:---------|:--------|:------|
| C    | Complete | 完整基因 | 数据库中的基因在你的基因组中找到了完整拷贝（含单拷贝和重复拷贝） |
| S    | Single-copy | 单拷贝 | 完整且只有一个拷贝的基因 |
| D    | Duplicated | 重复 | 完整但有多个拷贝的基因 |
| F    | Fragmented | 片段 | 只找到部分序列的基因 |
| M    | Missing | 缺失 | 没找到对应的基因 |
| n    | Number of BUSCOs | 数据库基因总数 | 例如 2026 表示该数据库有 2026 个核心基因 |
| E    | Extra | 额外匹配 | 一些版本的 BUSCO 会给出 E（extra or unexpected matches），表示匹配到的额外基因比例（不在数据库基因集合中） |

### 4.2 QUAST评估基因组组装质量

```
# 新建quast工作路径
mkdir -p /home/lvwei/work/example/hifiasm_output/fasta/quast
# 使用quast评估基因组组装质量
quast /home/lvwei/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa \
    -o /home/lvwei/work/example/hifiasm_output/fasta/quast \
    -t 40
```

查看结果：  
```
more ~/work/example/hifiasm_output/fasta/quast/report.txt
```

| 指标                        | 数值            | 说明                                   |
|-----------------------------|-----------------|--------------------------------------|
| Assembly                    | taishan01_hifiasm.hic.p_ctg | 组装名称                             |
| # contigs (>= 0 bp)         | 309             | 所有contig数量                       |
| # contigs (>= 1000 bp)      | 309             | 长度≥1000 bp的contig数量             |
| # contigs (>= 5000 bp)      | 309             | 长度≥5000 bp的contig数量             |
| # contigs (>= 10000 bp)     | 309             | 长度≥10000 bp的contig数量            |
| # contigs (>= 25000 bp)     | 302             | 长度≥25000 bp的contig数量            |
| # contigs (>= 50000 bp)     | 181             | 长度≥50000 bp的contig数量            |
| Total length (>= 0 bp)      | 628,886,467 bp  | 所有contig总长度                    |
| Total length (>= 25000 bp)  | 628,765,225 bp  | 长度≥25000 bp的contig总长度          |
| Total length (>= 50000 bp)  | 623,911,454 bp  | 长度≥50000 bp的contig总长度          |
| Largest contig              | 28,206,356 bp   | 最大contig长度                      |
| Total length                | 628,886,467 bp  | 组装总长度                          |
| GC (%)                     | 35.76%          | GC含量                             |
| N50                         | 20,838,880 bp   | N50长度，连续性指标                  |
| N90                         | 14,749,136 bp   | N90长度                            |
| auN                         | 19,935,546.4 bp | 平均连续性指标                      |
| L50                         | 14              | 达到50%长度所需contig数量           |
| L90                         | 28              | 达到90%长度所需contig数量           |

### 4.3 总结
C: 98.1% > 95% 且M:0.3%，组装完整性非常高  
共有309个contig，contig长度≥10kb，N50约20000k bp,L50 =14,组装连续性好  
PacBio HiFi CSS测序技术，长读长且高准确率，在使用hifiasm进行组装时默认进行3轮纠错，后续可以不使用二代测序数据进行纠错

## 5 纠错
若组装质量不高，使用二代测序数据进行纠错

## 6. 挂载到染色体
### 6.1 juicer+3d-dna
### 6.2 haphic