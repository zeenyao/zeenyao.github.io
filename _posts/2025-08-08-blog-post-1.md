---
title: '猕猴桃基因组组装'
date: 2025-08-08
permalink: /posts/2025/08/kiwifruit-genome-assembly/
tags:
  - 基因组
  - 猕猴桃
  - 生物信息学
---

# 介绍
猕猴桃（Actinidia chinensis）是一种重要的经济果树，因其富含维生素C和多种生物活性物质而广受欢迎。对猕猴桃进行高质量的基因组组装，不仅有助于解析其遗传背景和进化历史，还能为分子育种、抗病性研究以及果实品质改良提供关键的基因资源。

本研究采用了三种测序策略：  
PacBio HiFi CSS长读长测序：用于获得高准确度、长片段的序列，确保组装的连续性和准确性。  
Illumina短读长测序：用于K-mer分析、基因组特征估计及后续的纠错。  
Hi-C测序：用于利用染色质构象信息将contig精确定位并排列到染色体水平。  

# 组装流程
## 1. 数据准备

### 1.1 准备PacBio_HiFi_CSS、HIC测序数据和二代基因组测序数据
1. 任务名称为：  
    example
2. 三代基因组测序数据：  
    ~/data/example/PacBio_HiFi_CSS
3. HIC测序数据：  
    ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz
    ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz
4. 二代基因组测序数据：  
    ~/data/example/Illumina_WGS/example_wgs_R1.fastq.gz
    ~/data/example/Illumina_WGS/example_wgs_R2.fastq.gz

### 1.2合并hifi测序数据
```bash
cat ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/cell_1/example.ccs.fastq.gz \
    > ~/data/example/PacBio_HiFi_CSS/example.ccs.fastq.gz
```
在~/data/example/PacBio_HiFi_CSS路径下得到合并后的文件：example.ccs.fastq.gz，作为hifiasm的输入文件
## 2. 估计基因组的基本特征
### 2.1 用jellyfish和genomescope预测基因组大小
#### 2.1.1 解压
jellyfish只能读取未压缩的fastq、fasta文件，因此需要先解压example_wgs_R1.fastq.gz和example_wgs_R2.fastq.gz
```
# 进入二代基因组测序数据目录
cd ~/data/example/Illumina_WGS
# 解压并保留原文件
unzip -k example_wgs_R1.fastq.gz example_wgs_R2.fastq.gz
```
解压得到的文件为：  
example_wgs_R1.fastq：~/data/example/Illumina_WGS/example_wgs_R1.fastq
example_wgs_R2.fastq：~/data/example/Illumina_WGS/example_wgs_R2.fastq
#### 2.1.2 运行jellyfish
```
# 统计输入序列中的所有k-mer出现次数
jellyfish count -m 21 \
    -s 16G \
    -t 32 \
    -C \
    -o ~/data/example/Illumina_WGS/example.jf \
    ~/data/example/Illumina_WGS/example_wgs_R1.fastq \
    ~/data/example/Illumina_WGS/example_wgs_R2.fastq
# 从 Jellyfish 计数结果文件（.jf）中生成 k-mer 频率直方图
jellyfish histo -t 32 example.jf > example_21mer.histo
```
-m  指定 k-mer 长度  
-s  Hash 表大小，根据数据量和内存大小设置，如 1G 表示1GB  
-t 使用线程数  
-C  使用 canonical k-mers，正向和反向互补序列视为同一个k-mer，双端测序时使用  
-o  输出文件名，默认是二进制 .jf 文件  

#### 2.1.3 运行genomescope2
1. 使用在线网站：<http://genomescope.org/genomescope2.0/>
2. 使用本地genomescope2
```
genomescope.R \
    -i ~/data/example/Illumina_WGS/example_21mer.histo \
    -o ~/data/example/Illumina_WGS/example_21mer
    -k 21 \
    -p 2
```
-i jellyfish生成的 k-mer 频率直方图  
-o 输出路径(含结果文件夹名)  
-k jellyfish使用的 k-mer 长度  
-p 物种倍性

#### 2.1.4 结果查看
在~/data/example/Illumina_WGS/example_21mer中主要有四个图片：  
1. linear_plot.png：线性坐标系下的k-mer频率分布及模型拟合图
2. log_plot.png：对数坐标系下的k-mer频率分布图，更清晰显示低频和高频区域
3. transformed_linear_plot.png：经过数据变换后在线性坐标下的k-mer频率拟合图
4. transformed_log_plot.png：经过变换后的k-mer数据在对数坐标下的拟合图  

以transformed_linear_plot.png为例：
<img src="/images/posts/transformed_linear_plot.png" alt="transformed_linear_plot.png" width="500" class="img-center" />


| 项目  | 说明                                            |
|:-----:|------------------------------------------------|
| len   | 601,742,816 bp，估算基因组大小约 6.0 亿碱基对     |
| uniq  | 64.4%，基因组中大约 64.4% 是唯一序列（非重复序列） |
| aa    | 98.9%，基因组准确率或模型拟合度                   |
| ab    | 1.06%，杂合度，表示约 1.06% 碱基存在变异          |
| kcov  | 20.2，k-mer 平均覆盖深度（测序深度）              |
| err   | 0.173%，估算测序错误率                           |
| dup   | 1.65，估算重复率，重复序列的倍数                  |
| k     | 21，使用的 k-mer 长度                            |
| p     | 2，估计的基因组倍性，二倍体                       |

| 图标内容               | 说明                                                   |
|-----------------------|---------------------------------------------------------|
| 横轴（Coverage）     | k-mer 的覆盖深度，即 k-mer 在测序数据中出现的次数            |
| 纵轴（Coverage * Frequency） | 每个覆盖深度 k-mer 数量与其深度的乘积，反映覆盖深度贡献的基因组序列量 |
| 蓝色条形（observed）      | 实际测序数据中每个 k-mer 覆盖深度对应的 k-mer 总量                  |
| 黑色曲线（full model）    | GenomeScope 拟合的基因组模型曲线，显示整体趋势                     |
| 黄色曲线（unique sequence）| 估计唯一序列部分在不同覆盖深度的分布                             |
| 橙色曲线（errors）       | 测序错误产生的低覆盖 k-mer 贡献，主要在低覆盖（接近0）区域           |
| 虚线（kmer-peaks）       | k-mer 主峰位置，反映基因组的主要覆盖深度峰值                        |

注：这里的重复序列含量是基于K-mer分析得到的数学统计上的，与生物学重复（即有功能的重复元件）不同只是作为对基因组复杂程度估计的指标，为后续的基因组组装提供策略  

综上所述，样品基因组大小约为601.74 Mb，重复序列比例约35.6%，杂合率约1.06%，因此该物种基因组属于高杂合的复杂基因组

## 3.运行hifiasm进行组装:
### 3.1运行hifiasm加入hic数据分型组装：
```bash
# 新建hifiasm输出目录
mkdir -p ~/work/example/hifiasm_output
# 运行hifiasm
hifiasm \
    -o ~/work/example/hifiasm_outpou/example \
    -t 20 \
    --h1 ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz \
    --h2 ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz \
    ~/data/example/PacBio_HiFi_CSS/example.ccs.fastq.gz
```
-o 输出文件路径/输出文件前缀，默认输出路径为当前路径，默认文件前缀为 [hifiasm.asm]  
-t 使用线程数，默认 [1]  
--h1 Hi-C R1文件列表，例如 [r1_1.fq,r1_2.fq,...]  
--h2 Hi-C R2文件列表，例如 [r2_1.fq,r2_2.fq,...]  
更多详情请参考官方文档：<https://hifiasm.readthedocs.io/en/latest/>

主要输出文件有：  
example.p_ctg.gfa：主要 contig 的组装图该图包含长片段相位区块的完整组装
example.hic.hap1.p_ctg.gfa：完全相位的单倍型1 contig 图，其中每个 contig 都是完全相位的  
example.hic.hap2.p_ctg.gfa：完全相位的单倍型2 contig 图，其中每个 contig 都是完全相位的  
### 3.2提取组装结果，保存为fasta格式
```
# 新建hifiasm输出文件保存为fasta格式路径
mkdir -p ~/work/example/hifiasm_output/fasta
# 使用awk进行提取
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.hap1.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.hap1.p_ctg.fa
awk '/^S/{print ">"$2"\n"$3}' ~/work/example/hifiasm_output/example.hic.hap2.p_ctg.gfa \
    > ~/work/example/hifiasm_output/fasta/example.hic.hap2.p_ctg.fa
```
得到的三个文件路径为：  
example.hic.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa  
example.hic.hap1.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.hap1.p_ctg.fa  
example.hic.hap2.p_ctg.fa：~/work/example/hifiasm_output/fasta/example.hic.hap2.p_ctg.fa  
## 4. 组装质量检测
### 4.1 BUSCO评估基因组完整性
#### 4.1.1 BUSCO初始化
```
# 新建BUSCO数据库路径
mkdir -p ~/data/example/busco
# 进入BUSCO数据库路径
cd p ~/data/example/busco
#下载embryophyta_odb12数据库到当前路径
busco --download lineage_dataset embryophyta_odb12
```
#### 4.1.2 运行BUSCO评估基因组完整性
```
# 新建busco工作路径
mkdir -p ~/work/example/hifiasm_output/fasta/busco
# 进入busco工作路径
cd ~/work/example/hifiasm_output/fasta/busco
# 使用 BUSCO 评估基因组完整性
busco -c 16 \
    -i ~/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa \
    -l ~/data/example/busco/busco_downloads/lineages/embryophyta_odb12 \
    -m genome \
    -o example \
    --out_path ~/work/example/hifiasm_output/fasta/busco
```
-c 使用的线程数量  
-i 输入文件，FASTA格式  
-l 要使用的数据库的名称  
-m 运行 BUSCO 的模式  
-o 分析任务的名称输出文件夹和文件会以此命名  
--out_path指定输出目录（不含结果文件夹名），默认是当前工作目录  

查看结果：
```
more ~/work/example/hifiasm_output/fasta/busco/example/short_summary.specific.embryophyta_odb12.example.txt
``` 
C:98.1%[S:61.8%,D:36.3%],F:1.5%,M:0.3%,n:2026,E:2.6%

| 指标 | 英文全称 | 中文含义 | 说明 |
|:----:|:---------|:--------|:------|
| C    | Complete | 完整基因 | 数据库中的基因在你的基因组中找到了完整拷贝（含单拷贝和重复拷贝） |
| S    | Single-copy | 单拷贝 | 完整且只有一个拷贝的基因 |
| D    | Duplicated | 重复 | 完整但有多个拷贝的基因 |
| F    | Fragmented | 片段 | 只找到部分序列的基因 |
| M    | Missing | 缺失 | 没找到对应的基因 |
| n    | Number of BUSCOs | 数据库基因总数 | 例如 2026 表示该数据库有 2026 个核心基因 |
| E    | Extra | 额外匹配 | 一些版本的 BUSCO 会给出 E（extra or unexpected matches），表示匹配到的额外基因比例（不在数据库基因集合中） |

### 4.2 QUAST评估基因组组装质量

```
# 新建quast工作路径
mkdir -p /home/lvwei/work/example/hifiasm_output/fasta/quast
# 使用quast评估基因组组装质量
quast /home/lvwei/work/example/hifiasm_output/fasta/example.hic.p_ctg.fa \
    -o /home/lvwei/work/example/hifiasm_output/fasta/quast \
    -t 40
```

查看结果：  
```
more ~/work/example/hifiasm_output/fasta/quast/report.txt
```

| 指标                        | 数值            | 说明                                   |
|-----------------------------|-----------------|--------------------------------------|
| Assembly                    | example_hifiasm.hic.p_ctg | 组装名称                             |
| # contigs (>= 0 bp)         | 309             | 所有contig数量                       |
| # contigs (>= 1000 bp)      | 309             | 长度≥1000 bp的contig数量             |
| # contigs (>= 5000 bp)      | 309             | 长度≥5000 bp的contig数量             |
| # contigs (>= 10000 bp)     | 309             | 长度≥10000 bp的contig数量            |
| # contigs (>= 25000 bp)     | 302             | 长度≥25000 bp的contig数量            |
| # contigs (>= 50000 bp)     | 181             | 长度≥50000 bp的contig数量            |
| Total length (>= 0 bp)      | 628,886,467 bp  | 所有contig总长度                    |
| Total length (>= 25000 bp)  | 628,765,225 bp  | 长度≥25000 bp的contig总长度          |
| Total length (>= 50000 bp)  | 623,911,454 bp  | 长度≥50000 bp的contig总长度          |
| Largest contig              | 28,206,356 bp   | 最大contig长度                      |
| Total length                | 628,886,467 bp  | 组装总长度                          |
| GC (%)                     | 35.76%          | GC含量                             |
| N50                         | 20,838,880 bp   | N50长度，连续性指标                  |
| N90                         | 14,749,136 bp   | N90长度                            |
| auN                         | 19,935,546.4 bp | 平均连续性指标                      |
| L50                         | 14              | 达到50%长度所需contig数量           |
| L90                         | 28              | 达到90%长度所需contig数量           |

### 4.3 总结
C: 98.1% > 95% 且M:0.3%，组装完整性非常高  
共有309个contig，contig长度≥10kb，N50约20000k bp,L50 =14,组装连续性好  
PacBio HiFi CSS测序技术，长读长且高准确率，在使用hifiasm进行组装时默认进行3轮纠错，后续可以不使用二代测序数据进行纠错

## 5 纠错
若组装质量不高，使用二代测序数据进行纠错

## 6. 挂载到染色体
1. juicer+3d-dna：	由 Aiden Lab 开发（Juicer 的团队），经典且广泛使用，主要处理单倍型或混合组装，不直接分型
2. haphic：专注于三代测序结合 Hi-C 的高精度分型组装，支持单倍型分型组装（结合 hifiasm 输出的 hap1/hap2）
3. 对于高杂合度(1.0% >)复杂基因组，建议使用haphic进行组装
### 6.1 juicer+3d-dna 
#### 6.1.1 程序下载
```
# 新建juicer+3ddna工作路径
mkdir -p ~/work/example/juicer
# 下载juicer、juicer_tools和3d-dna
wget https://github.com/aidenlab/juicer/archive/refs/tags/1.6.tar.gz
wget https://github.com/aidenlab/Juicebox/releases/download/v2.20.00/juicer_tools.2.20.00.jar
wget https://github.com/aidenlab/3d-dna/archive/refs/tags/201008.tar.gz
# 解压
tar -zxvf 1.6.tar.gz
tar -zxvf 201008.tar.gz 
# 注意！juicer需要安装并使用GUN awk
sudo apt-get install gawk
gawk --version
alias awk='gawk'
source ~/.bashrc
```
共得到3个文件(夹)：  
3d-dna-201008  
juicer-1.6  
juicer_tools.2.20.00.jar
#### 6.1.2 文件准备
```
# 准备scripts
ln -s ~/work/example/juicer/juicer_tools.2.20.00.jar ~/work/example/juicer/juicer-1.6/CPU/common
ln -s ~/work/example/juicer/juicer-1.6/CPU ~/work/example/juicer/scripts
# 准备待分析基因组
mkdir -p ~/work/example/juicer/reference
ln -s ~/work/example/hifiasm_output/fasta/example_hifiasm.hic.p_ctg.fa ~/work/example/juicer/reference
# 准备hic文件
mkdir -p  ~/work/example/juicer/fastq
ln -s ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz ~/work/example/juicer/fastq/
ln -s ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz ~/work/example/juicer/fastq/
# 准备酶切位点文件
cd ~/work/example/juicer/reference
python ~/work/example/juicer-1.6/misc/generate_site_positions.py HindIII example example_hifiasm.hic.p_ctg.fa
# 准备每条 contig 长度文件
cd ~/work/example/juicer/reference
# 方法1，使用seqkit
seqkit fx2tab -l -n example_hifiasm.hic.p_ctg.fa > example.chrom.size
# 方法2，使用samtools
samtools faidx example_hifiasm.hic.p_ctg.fa
cut -f1,2 example_hifiasm.hic.p_ctg.fa.fai > example.chrom.size
```

```
# 进入juicer工作路径
cd ~/work/example/juicer
# 运行juicer.sh
bash scripts/juicer.sh \
    -g taishan01 \
    -s HindIII \
    -z ~/work/example/juicer/reference/taishan01_hifiasm.hic.p_ctg.fa \
    -p ~/work/example/juicer/reference/taishan01.chrom.sizes \
    -y ~/work/example/juicer/reference/taishan01_HindIII.txt \
    -D ~/work/example/juicer \
    -t 40
```
-g：基因组ID，和染色体文件名对应  
-s：限制性内切酶  
-z：参考基因组FASTA路径  
-p：染色体长度文件路径  
-y：酶切位点文件路径  
-D：Juicer工作目录  
-t：线程数  
运行时间很长，若重新运行请删除中间文件：aligned、HIC_tmp、splits


### 6.2 haphic

```
# 新建haphic工作目录
mkdir -p ~/work/example/haphic
# 进入haphic工作目录
cd ~/work/example/haphic
# 将初步组装文件链接到工作目录
ln -s ~/work/example/hifiasm_output/fasta/example_hifiasm.hic.p_ctg.fa ~/work/example/haphic/example_hifiasm.hic.p_ctg.fa
# 将 Hi-C 数据比对到组装结果，去除 PCR 重复，并过滤掉二次比对和补充比对结果
bwa index example_hifiasm.hic.p_ctg.fa
bwa mem -5SP -t 28 example_hifiasm.hic.p_ctg.fa \
    ~/data/example/Illumina_HIC/example_hic_R1.fastq.gz \
    ~/data/example/Illumina_HIC/example_hic_R2.fastq.gz \
    | samblaster \
    | samtools view - -@ 14 -S -h -b -F 3340 -o HiC.bam
# 过滤比对结果：保留比对质量（MAPQ）≥ 1 且编辑距离（NM tag）< 3 的数据
/path/to/HapHiC/utils/filter_bam HiC.bam 1 --nm 3 --threads 14 \
    | samtools view - -b -@ 14 -o HiC.filtered.bam
# 运行 HapHiC scaffolding 管道
haphic pipeline ~/work/example/hifiasm_output/fasta/example_hifiasm.hic.p_ctg.fa \
    HiC.filtered.bam \
    29 \
    --RE "AAGCTT"
```
我这里是已知29个染色体，Hi-C建库采用的HindIII酶切  
```
For HindIII --RE "AAGCTT"  
For Arima two-enzyme chemistry --RE "GATC,GANTC"  
For Arima four-enzyme chemistry --RE "GATC,GANTC,CTNAG,TTAA"  
```
未知染色体数量，可使用快速查看模式，详情请前往GitHub:<https://github.com/zengxiaofei/HapHiC>  

# 附录
conda env
blast	2.16.0	bioconda
bwa	0.7.19	bioconda
haphic	1.0.7	bioconda
hifiasm	0.25.0	bioconda
samblaster
Jellyfish 2.3.1 https://github.com/gmarcais/Jellyfish
genomescope2 2.0.1 https://github.com/tbenavi1/genomescope2.0
juicer 1.6 <https://github.com/aidenlab/juicer>
juicer_tools.jar  2.20.00  https://github.com/aidenlab/Juicebox
3d-dna 201008 https://github.com/aidenlab/3d-dna